
<html>
    <body>
        <form onsubmit="saveToLocalStorage(event)">
    <label> Name</label>
    <input id='username' type="text" name="username" required/>
    <label>EmailId</label>
    <input id='email' type="email" name="emailId" required/>
    <button>Submit</button>
    </form>
    <ul id='ListOfUsers'></ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js"></script>
    <script>
        function saveToLocalStorage(event){
            event.preventDefault();
            const name=event.target.username.value;
            const email=event.target.emailId.value;
            const Obj={
                name,
                email,
            }

            axios.post("https://crudcrud.com/api/84c6f391babb414caca4f6925211c5e5/data",Obj)
            .then((response)=>{
                showNewUserOnScreen(response.data)
                console.log(response)
            })
            .catch((err)=>{
                document.body.innerHTML =document.body.innerHTML +"<h4>something went wrong</h4>"
                console.log(err)
            })

            //localStorage.setItem(Obj.email, JSON.stringify(Obj))
            //showNewUserOnScreen(Obj)
        }

        window.addEventListener("DOMContentLoaded", ()=>{
            const data = axios.get("https://crudcrud.com/api/84c6f391babb414caca4f6925211c5e5/data")
            .then((response)=>{
                //console.log(response)

                for(var i=0;i<response.data.length;i++){
                    showNewUserOnScreen(response.data[i])

                }
            })
            .catch((err)=>{
                console.log(err)
            })
           console.log(data);
        })
        function showNewUserOnScreen(user){

            user={
                _id:'',
                name:'',
                email:'',
            }
            document.getElementById("email").value='';
            document.getElementById("username").value='';
            //console.log(localStrorage.getItem(user.emailId))
            if(localStorage.getItem(user.email) !==null){
                removeUserFromScreen(user.email)
            }
            const parentNode=document.getElementById('ListOfUsers');
            const childHTML=`<li id=${user._id}> ${user.name} - ${user.email}<button onclick=deleteUser(${user._id})>delete</li>`
                        
            parentNode.innerHTML=parentNode.innerHTML + childHTML;
        }

        function editUserDetails(emailId,name,phonenumber){
            document.getElementById("email").value=emailId;
            document.getElementById("username").value=name;
            deleteUser(emailId)
        }

        function deleteUser(userId){
            axios.delete(`https://crudcrud.com/api/84c6f391babb414caca4f6925211c5e5/data/${userId}`)
            .then((response)=>{
                console.log(response)
               
            })
            .catch((err)=>{
                console.log(err)
            })

       
        }
        function removeUserFromScreen(userId){
            const parentNOde =document.getElementById('ListOfUser');
            const childNodeToBeDeleted = document.getElementById(userId);
            if(childNodeToBeDeleted){
                parentNode.removeChild(childNodeToBeDeleted)
            }
        }
    </script>
    </body>
</html>
    
